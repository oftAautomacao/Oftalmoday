<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Conex√£o Firebase</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .log {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        button {
            padding: 10px 15px;
            background-color: #1976d2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px 0;
        }
        button:hover {
            background-color: #1565c0;
        }
    </style>
</head>
<body>
    <h1>Teste de Conex√£o Firebase</h1>
    
    <div>
        <button id="testProd">Testar Ambiente de Produ√ß√£o</button>
        <button id="testTest">Testar Ambiente de Teste</button>
        <button id="clearLog">Limpar Log</button>
    </div>
    
    <h3>Log de Sa√≠da:</h3>
    <div id="log" class="log"></div>

    <script>
        const logElement = document.getElementById('log');
        
        function log(message, type = 'info') {
            const p = document.createElement('p');
            p.className = type;
            p.textContent = message;
            logElement.appendChild(p);
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[${type}] ${message}`);
        }
        
        function clearLog() {
            logElement.innerHTML = '';
        }
        
        document.getElementById('clearLog').addEventListener('click', clearLog);
        
        // Configura√ß√µes do Firebase
        const firebaseConfigs = {
            teste: {
                apiKey: "AIzaSyBTSTqEZARRrIOPwtTcysbw5RjjvXFuFDw",
                authDomain: "teste-b720c.firebaseapp.com",
                databaseURL: "https://teste-b720c-default-rtdb.firebaseio.com",
                projectId: "teste-b720c",
                storageBucket: "teste-b720c.appspot.com",
                messagingSenderId: "1016885444024",
                appId: "1:1016885444024:web:5f8e8f8e8f8e8f8e8f8e8"
            },
            producao: {
                apiKey: "AIzaSyDseoXikJofokNkYoU-Sm6wf_N9EIZbmrs",
                authDomain: "oftautomacao-9b427.firebaseapp.com",
                databaseURL: "https://oftautomacao-9b427-default-rtdb.firebaseio.com",
                projectId: "oftautomacao-9b427",
                storageBucket: "oftautomacao-9b427.appspot.com",
                messagingSenderId: "755832525715",
                appId: "1:755832525715:web:8f8e8f8e8f8e8f8e8f8e8"
            }
        };
        
        async function testConnection(env) {
            log(`\n=== Iniciando teste no ambiente ${env.toUpperCase()} ===`, 'info');
            
            try {
                // Inicializa o Firebase
                log(`Inicializando Firebase (${env})...`, 'info');
                const app = firebase.initializeApp(firebaseConfigs[env], `test-${Date.now()}`);
                const db = firebase.database();
                
                // Testa o n√≥ raiz
                log('\nüîç Acessando o n√≥ raiz...', 'info');
                const rootRef = db.ref('/');
                const rootSnapshot = await rootRef.once('value');
                
                if (rootSnapshot.exists()) {
                    log('‚úÖ Conex√£o bem-sucedida!', 'success');
                    log('Dados do n√≥ raiz: ' + JSON.stringify(rootSnapshot.val()), 'info');
                } else {
                    log('‚ö†Ô∏è Nenhum dado encontrado no n√≥ raiz', 'warning');
                }
                
                // Tenta acessar o caminho espec√≠fico
                log('\nüîç Tentando acessar o caminho espec√≠fico...', 'info');
                const specificRef = db.ref('/OFT/45/confirmacaoPacientes/erro');
                const specificSnapshot = await specificRef.once('value');
                
                if (specificSnapshot.exists()) {
                    log('‚úÖ Dados encontrados no caminho espec√≠fico!', 'success');
                    const data = specificSnapshot.val();
                    log('Primeiro item: ' + JSON.stringify(Object.values(data)[0]), 'info');
                } else {
                    log('‚ö†Ô∏è Nenhum dado encontrado no caminho espec√≠fico', 'warning');
                }
                
            } catch (error) {
                log(`‚ùå Erro ao conectar ao Firebase (${env}): ${error.message}`, 'error');
                console.error(error);
            } finally {
                // Limpa a inst√¢ncia do Firebase
                try {
                    firebase.app().delete();
                } catch (e) {
                    console.warn('Erro ao limpar inst√¢ncia do Firebase:', e);
                }
            }
        }
        
        // Event listeners para os bot√µes
        document.getElementById('testProd').addEventListener('click', () => testConnection('producao'));
        document.getElementById('testTest').addEventListener('click', () => testConnection('teste'));
        
        log('Clique em um dos bot√µes acima para testar a conex√£o com o Firebase.', 'info');
    </script>
</body>
</html>
